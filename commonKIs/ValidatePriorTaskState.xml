<?xml version="1.0" encoding="UTF-8"?>
<KnowledgeItem xmlns="http://www.arago.de/KiSchema" ID="arago:WorkFlowUserStory:ValidatePriorTaskState">
	<Title>ValidatePriorTaskState</Title>
	<Description>Validation if the Prior Task is done and based on that set the state to ReadState</Description>
	
	<BindAttributes>
		<Description>Bind to all machine Nodes with Tasks block in Extensions where CurrentState is equal to the ReadState and pick the PRIORTASK and CURRENTTASK</Description>
		<AttributeFilter Name="NodeType" Mode="exists"/>
		<SubItem Name="OSInformation" Alias="OSINFO">
			<AttributeFilter Name="Name" Mode="exists"/>
		</SubItem>
		<SubItem Name="Extensions"  Alias="EXTS"> 
			<SubItem Name="Tasks" Alias="PRIORTASK" >
				<AttributeFilter Name="TargetMachine" Mode="exists"/>
				<AttributeFilter Name="TargetState" Mode="exists"/>
				<AttributeFilter Name="CurrentState" Mode="string" Value="Created" />
			</SubItem>
			<SubItem Name="Tasks" Alias="CURRENTTASK" >
				<AttributeFilter Name="TargetMachine" Mode="exists"/>
				<AttributeFilter Name="TargetState" Mode="exists"/>
				<AttributeFilter Name="CurrentState" Mode="string" Value="WaitForPrior" />
				<AttributeFilter Name="PriorUID" Mode="string" Value="${PRIORTASK:UID}"/>	
			</SubItem> 
		</SubItem> 		
	</BindAttributes>
	
	<Log>__KI ${KIID} is now bound to ${NODE:NodeID}__</Log>
	
	<CreateTrigger>	
		<IssueCondition>
			<Description>Triggers if UID in the Node Extensions and  ExtUID attribute of the Validate Block in the Issue matches, and in binding conditions Node:Extensions:Task:CurrentState has value ReadState</Description>		 
			<SubItem Name="Validate"  Alias="VAL" > 
				<AttributeFilter Name="ExtUID" Mode="string" Value="${CURRENTTASK:UID}" />
				<AttributeFilter Name="Status" Mode="notexists"/>		
			</SubItem> 
		</IssueCondition> 
			
		<Activate>
			<SetAttribute Name="CURRENTTASK:CurrentState" Value="ReadState"/>		
		</Activate>
	</CreateTrigger>
</KnowledgeItem>
